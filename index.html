<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>IoT Project</title>
</head>
<body>
  
    <div style="background-color: blue; height: 60px;color: white;margin-bottom: 30px;line-height: 60px;padding-left: 30px; margin-block-start: 0px;">
      <h1>My Home</h1>
    </div>

    <div id="main-page">
      <div class="page">
        <h1 class="heading">BedRoom</h1>
        <div class="info">
          <p>Nhiệt độ hiện tại:    <span id="temp"></span> độ C</p>
          <p>Độ ẩm hiện tại:    <span id="humi"></span> %</p>
        </div>
        <div class="mode-btn">
          <div class="mode-btn-heading">
            <h1>Mode</h1>
            <h1 id="selected-mode-bed"></h1>
          </div>
          <div class="btn-box">
            <button id="auto-btn-bed", class='btn'>AUTO</button>
            <button id="manual-btn-bed", class='btn'>MANUAL</button>
          </div>
        </div>
        <div class="device-state">
          <div class="device-state-heading">
            <h1>Fan</h1>
            <h1 id="fan"></h1>
          </div>
          <div class="btn-box">
            <button id="turn-on-fan", class='btn'>ON</button>
            <button id="turn-off-fan", class='btn'>OFF</button>
          </div>
        </div>
      </div>
      <div class="page">
        <h1 class="heading">Living Room</h1>
        <div class="info">
          <p>Mức sáng trong phòng hiện tại:      <span id="light"></span></p>
        </div>
        <div class="mode-btn">
          <div class="mode-btn-heading">
            <h1>Mode</h1>
            <h1 id="selected-mode-living"></h1>
          </div>
          <div class="btn-box">
            <button id="auto-btn-living", class='btn'>AUTO</button>
            <button id="manual-btn-living", class='btn'>MANUAL</button>
          </div>
        </div>
        <div class="device-state">
          <div class="device-state-heading">
            <h1>Led</h1>
            <h1 id="led"></h1>
          </div>
          <div class="btn-box">
            <button id="turn-on-led", class='btn'>ON</button>
            <button id="turn-off-led", class='btn'>OFF</button>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-analytics.js";
      import { getDatabase, ref , child, get, set } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyAs-437oEDJhrBC6K3as4pLgFK9bBNln10",
        authDomain: "esp8266-gateway-firebase.firebaseapp.com",
        databaseURL: "https://esp8266-gateway-firebase-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "esp8266-gateway-firebase",
        storageBucket: "esp8266-gateway-firebase.appspot.com",
        messagingSenderId: "400010165428",
        appId: "1:400010165428:web:a2116238f4b3002cf2abe1"
};
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getDatabase(app);
      const dbRef = ref(getDatabase());
      setInterval(function(){
        get(child(dbRef, "BED")).then((snapshot) => {
        if (snapshot.exists()) {
          document.getElementById("humi").innerHTML = snapshot.val().humi;
          document.getElementById("temp").innerHTML = snapshot.val().temp;
        } else {
          console.log("No data available");
        }
      }).catch((error) => {
        console.error(error);
      
      });
      get(child(dbRef, "LIVING")).then((snapshot) => {
        if (snapshot.exists()) {
          document.getElementById("light").innerHTML = snapshot.val().light;
        } else {
          console.log("No data available");
        }
      }).catch((error) => {
        console.error(error);
      
      });
      get(child(dbRef, "BED")).then((snapshot) => {
        if (snapshot.exists()) {
          document.getElementById("fan").innerHTML = snapshot.val().FAN.FAN_STATUS;
          document.getElementById("selected-mode-bed").innerHTML = snapshot.val().MODE.SELECTED_MODE_BED;
        } else {
          console.log("No data available");
        }
      }).catch((error) => {
        console.error(error);
      
      });
      get(child(dbRef, "LIVING")).then((snapshot) => {
        if (snapshot.exists()) {
          document.getElementById("led").innerHTML = snapshot.val().LED.LED_STATUS;
          document.getElementById("selected-mode-living").innerHTML = snapshot.val().MODE.SELECTED_MODE_LIVING;        
        } else {
          console.log("No data available");
        }
      }).catch((error) => {
        console.error(error);
      
      });
    },0)
      function turnONLED() {
        set(ref(db, 'LIVING/LED'), {
          LED_STATUS : 'on'
        });
      };
      function turnOFFLED() {
        set(ref(db, 'LIVING/LED'), {
          LED_STATUS : 'off'
        });
      };
      function turnONFAN() {
        set(ref(db, 'BED/FAN'), {
          FAN_STATUS : 'on'
        });
      };
      function turnOFFFAN() {
        set(ref(db, 'BED/FAN'), {
          FAN_STATUS : 'off'
        });
      };
      function selectmodeAB(){      
        set(ref(db, 'BED/MODE'), {
          SELECTED_MODE_BED : 'auto'
        });
      };
      function selectmodeMB(){
        set(ref(db, 'BED/MODE'), {
          SELECTED_MODE_BED : 'manual'
        });
      };
      function selectmodeAL(){      
        set(ref(db, 'LIVING/MODE'), {
          SELECTED_MODE_LIVING : 'auto'
        });
      };
      function selectmodeML(){
        set(ref(db, 'LIVING/MODE'), {
          SELECTED_MODE_LIVING : 'manual'
        });
      }
      const manual_btn_bed = document.getElementById("manual-btn-bed");
      manual_btn_bed.addEventListener("click", selectmodeMB);
      const auto_btn_bed = document.getElementById("auto-btn-bed");
      auto_btn_bed.addEventListener("click", selectmodeAB);
      const btn_on_fan = document.getElementById("turn-on-fan");
      btn_on_fan.addEventListener("click", turnONFAN);
      const btn_off_fan = document.getElementById("turn-off-fan");
      btn_off_fan.addEventListener("click", turnOFFFAN);
      const manual_btn_living = document.getElementById("manual-btn-living");
      manual_btn_living.addEventListener("click", selectmodeML);
      const auto_btn_living = document.getElementById("auto-btn-living");
      auto_btn_living.addEventListener("click", selectmodeAL);
      const btn_on_led = document.getElementById("turn-on-led");
      btn_on_led.addEventListener("click", turnONLED);
      const btn_off_led = document.getElementById("turn-off-led");
      btn_off_led.addEventListener("click", turnOFFLED);
      

    </script>
    
    <!-- <script>  
     function turnON() {
        console.log('on');
        set(ref(db, 'LED'), {

          LED_STATUS : 'ON'
        });
      };
      function turnOFF() {
        set(ref(db, 'LED'), {
          LED_STATUS : 'OFF'
        });
      }
    </script> -->
</body>
</html>