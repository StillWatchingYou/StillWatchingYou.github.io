<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <title>IoT Project</title>
</head>
<body>
  
    <div style="background-color: blue; height: 60px;color: white;margin-bottom: 30px;line-height: 60px;padding-left: 30px; margin-block-start: 0px;">
      <h1>My Home</h1>
    </div>

    <div id="main-page">
      <div class="page">
        <h1 class="heading">BedRoom</h1>
        <div class="info">
          <p>Nhiệt độ hiện tại là <span id="temp"></span> độ C</p>
          <p>Độ ẩm hiện tại là <span id="humi"></span> %</p>
        </div>
        <div class="mode-btn">
          <div class="mode-btn-heading">
            <h1>Mode</h1>
            <h1 id="selected-mode-bed"></h1>
          </div>
          <div class="btn-box">
            <button id="auto-btn-bed", class='btn'>AUTO</button>
            <button id="manual-btn-bed", class='btn'>MANUAL</button>
          </div>
        </div>
        <div class="device-state">
          <div class="device-state-heading">
            <h1>Fan</h1>
            <h1 id="fan"></h1>
          </div>
          <div class="btn-box">
            <button id="turn-on-fan", class='btn'>ON</button>
            <button id="turn-off-fan", class='btn'>OFF</button>
          </div>
        </div>
      </div>
      <div class="page">
        <h1 class="heading">Living Room</h1>
        <div class="info">
          <p>Nhiệt độ hiện tại là <span id="temp"></span> độ C</p>
          <p>Độ ẩm hiện tại là <span id="humi"></span> %</p>
        </div>
        <div class="mode-btn">
          <div class="mode-btn-heading">
            <h1>Mode</h1>
            <h1>Manual</h1>
          </div>
          <div class="btn-box">
            <button class='btn',class="auto-btn">AUTO</button>
            <button class='btn',class="manual-btn">MANUAL</button>
          </div>
        </div>
        <div class="device-state">
          <div class="device-state-heading">
            <h1>Fan</h1>
            <h1 id="led"></h1>
          </div>
          <div class="btn-box">
            <button id="turn-on-led", class='btn'>ON</button>
            <button id="turn-off-led", class='btn'>OFF</button>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-analytics.js";
      import { getDatabase, ref , child, get, set } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyAqBhr1DQVLIqBwCb1X6AkU838Va8vcB9k",
        authDomain: "esp32-firebase-35007.firebaseapp.com",
        databaseURL: "https://esp32-firebase-35007-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "esp32-firebase-35007",
        storageBucket: "esp32-firebase-35007.appspot.com",
        messagingSenderId: "346343301999",
        appId: "1:346343301999:web:bcb20f9d27076683f83e9a",
        measurementId: "G-VRC1E72472"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getDatabase(app);
      const dbRef = ref(getDatabase());
      setInterval(function(){
        get(child(dbRef, "1")).then((snapshot) => {
        if (snapshot.exists()) {
          document.getElementById("humi").innerHTML = snapshot.val().humi;
          document.getElementById("temp").innerHTML = snapshot.val().temp;
        } else {
          console.log("No data available");
        }
      }).catch((error) => {
        console.error(error);
      
      });
      get(child(dbRef, "LED")).then((snapshot) => {
        if (snapshot.exists()) {
          document.getElementById("fan").innerHTML = snapshot.val().LED_STATUS;
        } else {
          console.log("No data available");
        }
      }).catch((error) => {
        console.error(error);
      
      });
      get(child(dbRef, "MODE")).then((snapshot) => {
        if (snapshot.exists()) {
          document.getElementById("selected-mode-bed").innerHTML = snapshot.val().SELECTED_MODE;
        } else {
          console.log("No data available");
        }
      }).catch((error) => {
        console.error(error);
      
      });
    },0)
      function turnONLED1() {
        console.log('on')
        set(ref(db, 'LED'), {
          LED_STATUS : 'ON'
        });
      };
      function turnOFFLED1() {
        set(ref(db, 'LED'), {
          LED_STATUS : 'OFF'
        });
      };
      function selectmodeA1(){
        set(ref(db, 'MODE'), {
          SELECTED_MODE : 'AUTO'
        });
      };
      function selectmodeM1(){
        set(ref(db, 'MODE'), {
          SELECTED_MODE : 'MANUAL'
        });
      }
      const manual_btn_bed = document.getElementById("manual-btn-bed");
      manual_btn_bed.addEventListener("click", selectmodeM1);
      const auto_btn_bed = document.getElementById("auto-btn-bed");
      auto_btn_bed.addEventListener("click", selectmodeA1);
      const btn_on_fan = document.getElementById("turn-on-fan");
      btn_on_fan.addEventListener("click", turnONLED1);
      const btn_off_fan = document.getElementById("turn-off-fan");
      btn_off_fan.addEventListener("click", turnOFFLED1);

    </script>
    
    <!-- <script>  
     function turnON() {
        console.log('on');
        set(ref(db, 'LED'), {

          LED_STATUS : 'ON'
        });
      };
      function turnOFF() {
        set(ref(db, 'LED'), {
          LED_STATUS : 'OFF'
        });
      }
    </script> -->
</body>
</html>